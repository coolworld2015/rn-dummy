<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no">

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.0.3/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/1.0.3/vue-resource.min.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcEkMFV_WyhNdZrr8VLaCYOw4FP75u748"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style>
    ::-webkit-scrollbar {
        display: none;
    }

    html {
        background: #f6f6f6;
        overflow: hidden;
    }

    body {
        background: white;
        margin: 0;
        padding: 0;
    }

    .top {
        position: fixed;
        top: 0px;
        width: 100%;
        display: block;
        background: white;
        padding: 5px;
        height: 85px;
        color: #ef835d;
        font-size: 200%;
        text-align: center;
        border-bottom: 1px solid #d1d1d1;
        box-shadow: 0 1px 2px rgba(0, 0, 0, .1);
    }

    .middle {
        background: #f6f6f6;
        /*margin-top: 50px;*/
        width: 100%;
        height: 100%;
        color: #ef835d;
        color: black;
        font-size: 200%;
        text-align: center;
        overflow-y: scroll;
        border-top: 1px solid #d1d1d1;
    }

    .bottom {
        position: fixed;
        bottom: 0px;
        width: 100%;
        /*background: red;*/
        background: #01579B;
        padding: 5px;
        height: 40px;
        color: white;
        font-size: 30px;
        text-align: center;
        border-top: 1px solid #d1d1d1;
    }

    .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 1;
        top: 0;
        left: 0;
        background-color: #111;
        overflow-x: hidden;
        transition: 0.2s;
        padding-top: 60px;
        box-shadow: rgba(0, 0, 0, 0.35) 3px 0px 10px 0px;
    }

    .sidenav a {
        padding: 8px 8px 8px 32px;
        text-decoration: none;
        font-size: 25px;
        color: #818181;
        display: block;
        transition: 0.2s;
    }

    .sidenav a:hover {
        color: #f1f1f1;
    }

    .sidenav .closebtn {
        position: absolute;
        top: 0;
        right: 5px;
        font-size: 36px;
        margin-left: 50px;
    }

    #main {
        transition: margin-left .2s;
    / / padding: 16 px;
    }

    @media screen and (max-height: 450px) {
        .sidenav {
            padding-top: 15px;
        }

        .sidenav a {
            font-size: 18px;
        }
    }

    ul {
        padding-inline-start: 0;
        font-size: 25px;
        /*text-shadow: #000 0.15em 0.15em 0.15em;*/
    }

    li {
        list-style-type: none;
        color: white;
        padding: 20px;
        border-bottom: solid 1px black;
    }

    li:hover {
        background: whitesmoke;
        color: black;
    }

    .active {
        background: white;
        color: black;
    }
</style>

<div id="app">
    <div id="mySidenav" class="sidenav">
        <div style="color: white;margin-top: -48px;margin-left: 12px;font-size: 30px;width: 200px;">
            Google Maps API Demo
        </div>
        <div style="color: white;margin-top: 20px;margin-left: 15px;font-size: 20px;width: 200px;">
            by Eduard Tkachuk
        </div>
        <ul>
            <a href="" class="closebtn" onclick="event.preventDefault();closeNav()"> &times;</a>

            <li v-on:click="changeRoute('map')" v-bind:class="{ active: map }">
                <i class="fa fa-fw fa-map"></i><span style="margin: 15px;">Map</span></li>

            <li v-on:click="emitEvent('pos')" v-bind:class="{ active: pos }">
                <i class="fa fa-fw fa-map-marker"></i><span style="margin: 15px;">Position</span></li>

            <li v-on:click="emitEvent('locBlanco')" v-bind:class="{ active: pos }">
                <i class="fa fa-fw fa-map-marker"></i><span style="margin: 15px;">Blanco</span></li>
        </ul>
    </div>

    <div id="main">
        <div class="middle">
            <router-view></router-view>
        </div>
    </div>
</div>
</div>

<script>
    const appConfig = new Vue();
    appConfig.route = 'map';

    const GoogleMap = {
        template: `
                    <div>
                        <div class="top"><top-map></top-map></div>
                        <div style="margin-top: 96px;"><google-map></google-map></div>
                    </div>`
    };

    Vue.component('googleMap', {
        template: '<div class="middle" id="map"></div>',
        data() {
            return {
                map: '',
                symbolOne: {
                    path: 'M -2,0 0,-2 2,0 0,2 z',
                    strokeColor: 'gold',
                    fillColor: 'gold',
                    fillOpacity: 1,
                    scale: 3,
                },
                image: '../img/blue-circle.png',
                truck: '../img/truck.png',
                truck_f: '../img/truck_f.png',
                locations: [
                    ['<div style="margin: 0px; color: black"><img src="../img/blue-circle.png" style="margin: 15px; width: 200px"><br><b>Point1</b></div>', 49.093086, 8.533068, 1],
                    ['Point2', 49.147995, 8.559998, 2],
                    ['Point3', 49.116544, 8.551161, 3]
                ],
                flightPath: new google.maps.Polyline({
                    path: [
                        {lat: 49.093086, lng: 8.533068},
                        {lat: 49.106580, lng: 8.544306},
                        {lat: 49.116544, lng: 8.551161},
                        {lat: 49.128808, lng: 8.550718},
                        {lat: 49.133488, lng: 8.551667},
                        {lat: 49.147995, lng: 8.559998},
                    ],
                    geodesic: true,
                    strokeColor: '#01579B',
                    strokeOpacity: 1.0,
                    strokeWeight: 6
                })
            }
        },
        created() {
            setTimeout(this.init, 500);
            appConfig.$on('pos', searchQuery => {
                this.getPos();
            });
            appConfig.$on('locBlanco', searchQuery => {
                this.locBlanco();
            });
        },
        methods: {
            init() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 13,
                    center: new google.maps.LatLng(49.124966, 8.552490),
                    mapTypeId: google.maps.MapTypeId.ROADMAP
                    //mapTypeId: google.maps.MapTypeId.SATELLITE
                });

                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(49.124966, 8.552490),
                    draggable: true,
                    animation: google.maps.Animation.BOUNCE,
                    icon: this.symbolOne,
                    map: map
                });
                appConfig.map = true;
                this.setPoints();
                this.showRoutes()
            },
            locBlanco() {
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 18,
                    center: new google.maps.LatLng(49.1234807, 8.5564619),
                    //mapTypeId: google.maps.MapTypeId.ROADMAP
                    mapTypeId: google.maps.MapTypeId.SATELLITE
                });

                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(49.1242421, 8.5586618),
                    draggable: true,
                    title: 'Truck 12345',
                    //animation: google.maps.Animation.BOUNCE,
                    icon: this.truck,
                    map: map
                });

                marker1 = new google.maps.Marker({
                    position: new google.maps.LatLng(49.1232625, 8.5555243),
                    draggable: true,
                    title: 'Truck 12345',
                    //animation: google.maps.Animation.BOUNCE,
                    icon: this.truck_f,
                    map: map
                });

                var infowindow = new google.maps.InfoWindow();

                google.maps.event.addListener(marker, 'click', function () {
                    infowindow.setContent('<h3>Truck 1 - Moving &nbsp&nbsp</h3>');
                    infowindow.open(map, marker);
                });
                google.maps.event.addListener(marker1, 'click', function () {
                    infowindow.setContent('<h3>Truck 2 - Docked &nbsp&nbsp</h3>');
                    infowindow.open(map, marker1);
                });

                appConfig.map = true;
                //this.setPoints();
                //this.showRoutes()
            },
            setPoints() {
                var infowindow = new google.maps.InfoWindow();

                for (var i = 0; i < this.locations.length; i++) {
                    marker = new google.maps.Marker({
                        position: new google.maps.LatLng(this.locations[i][1], this.locations[i][2]),
                        map: map
                    });
                    var locations = [].concat(this.locations);
                    google.maps.event.addListener(marker, 'click', (function (marker, i) {
                        return function () {
                            infowindow.setContent(locations[i][0]);
                            infowindow.open(map, marker);
                        }
                    })(marker, i));
                }
            },
            showRoutes() {
                this.flightPath.setMap(map);
            },
            getPos() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(this.showPosition);
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            },

            showPosition(position) {
                if (marker) {
                    marker.setMap(null);
                }

                var lat = position.coords.latitude;
                var lng = position.coords.longitude;

                map.setCenter(new google.maps.LatLng(lat, lng));
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(lat, lng),
                    draggable: true,
                    //animation: google.maps.Animation.BOUNCE,
                    icon: this.image,
                    map: map
                });
            }
        },
    });

    Vue.component('top-map', {
        template: `<div>
        <div style="float: left; margin: 20px; margin-top: 4px;">
                <span style="font-size:30px;cursor:pointer; color: black" onclick="openNav()">&#9776;</span>
        </div>
        <div style="margin-top: 15px; color: #01579B; font-size: 50px;margin-right: 100px;">
            Google Maps API Demo
        </div>
        </div>`,
        data() {
            return {
                searchQuery: '',
            };
        },
        methods: {
            changeView() {
                appConfig.$emit('searchQuery', this.searchQuery);
            },
            searchClear() {
                this.searchQuery = '';
                appConfig.$emit('searchQuery', this.searchQuery);
            },
        },
    });

    const routes = [
        {path: '/', component: GoogleMap},
        {path: '/map', component: GoogleMap},
    ];

    const router = new VueRouter({
        routes,
    });

    new Vue({
        el: '#app',
        router,
        data: {
            map: false,
            pos: ''
        },
        created() {
            this.init();
        },
        methods: {
            init() {
                this.map = appConfig.route === 'map';
            },
            changeRoute(route) {
                closeNav();
                appConfig.route = route;
                this.init();
                this.$router.push('/' + route);
                return false;
            },
            emitEvent(event) {
                appConfig.$emit(event, {});
                this.map = true;
                closeNav();
            }
        },
    });

    function openNav() {
        document.getElementById('mySidenav').style.width = '250px';
    }

    function closeNav() {
        document.getElementById('mySidenav').style.width = '0';
        return false;
    }
</script>

